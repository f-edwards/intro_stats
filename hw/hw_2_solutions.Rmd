---
title: "HW 2 Solutions"
author: "Frank Edwards"
date: "9/18/2019"
output: html_document
---

```{r echo = FALSE, message = FALSE}
rm(list=ls())
library(qss)
library(tidyverse)
data(Sweden)
data(Kenya)
data(World)
```

## Question 1

```{r}

Sweden<-Sweden %>% 
  mutate(py.total = py.women + py.men)

Sweden_cbr <- Sweden %>% 
  group_by(period) %>% 
  summarise(CBR = sum(births)/sum(py.total))

Kenya<-Kenya %>% 
  mutate(py.total = py.women + py.men)

Kenya_cbr<- Kenya %>% 
  group_by(period) %>% 
  summarise(CBR = sum(births)/sum(py.total))

World<-World %>% 
  mutate(py.total = py.women + py.men)

World_cbr<- World %>% 
  group_by(period) %>% 
  summarise(CBR = sum(births)/sum(py.total))

Kenya_cbr
Sweden_cbr
World_cbr
```

I calculate the crude birth rate for Kenya, Sweden, and the full world using data from two period, 1950-1955 and 2005-2010. Globally, the crude birth rate fell over these 55 years from `r round(World_cbr$CBR[1],3)` births per person-year in 1950-1955 to `r round(World_cbr$CBR[2],3)` births per person-year in 2005-2010. Rates fell in both Kenya and Sweden as well. Kenya's rate declined from `r round(Kenya_cbr$CBR[1],3)` births per person-year in 1950-1955 to `r round(Kenya_cbr$CBR[2],3)` in 2005-2010. In Sweden, crude birth rates fell from `r round(Sweden_cbr$CBR[1],3)` in 1950-1955 to `r round(Sweden_cbr$CBR[2],3)` in 2005-2010.

## Question 2

```{r}
### I write a function to make this a bit easier to code. this function will calculate asfr for any data.frame of the appropriate structure I give it.
make_asfr<-function(x){
  x<-x %>% 
    mutate(asfr = births/py.women)
  return(x)
}

Sweden<-make_asfr(Sweden)
Kenya<-make_asfr(Kenya)
World<-make_asfr(World)

### SHOW ASFR FOR REPODUCTIVE-AGE WOMEN FOR ALL PERIODS/COUNTRIES
Sweden %>% 
  filter(asfr>0) %>% 
  select(country, period, age, asfr)

Kenya %>% 
  filter(asfr>0) %>% 
  select(country, period, age, asfr)

World%>% 
  filter(asfr>0) %>% 
  select(country, period, age, asfr)
```

Age-specific fertility rates (ASFR) provides a measure of births per women's person-year lived by age-group. Above, I display the ASFR for Kenya, Sweden, and the global population for reproductive-age women (15-19 through 45-49).  The maximum ASFR observed for Sweden across this period is `r round(max(Sweden$asfr),3)`, observed among 30-34 year olds in 2005-2010. The maximum ASFR observed for Kenya is `r round(max(Kenya$asfr),3)`, observed among 20-24 year olds in 1950-1955. The maximum global ASFR in this data is `r round(max(World$asfr),3)`, observed among 25-29 year olds in 1950-1955. At their maximum values, Kenya's ASFR outpaced both Sweden and the global average.

## Question 3

```{r}
make_tfr<-function(x){
  ## get repro age index from world, ID 14-49
  repro_ages<-unique(World$age)[4:10]
  tfr<-x %>% 
    filter(age%in%repro_ages) %>% ## filter for age in repro_ages
    group_by(period) %>% 
    summarise(tfr = sum(asfr*5))
  return(tfr)
}

Sweden_tfr<-make_tfr(Sweden)
Kenya_tfr<-make_tfr(Kenya)
World_tfr<-make_tfr(World)

Sweden_tfr
Kenya_tfr
World_tfr
```

Total fertility rates (TFR) provide a measure of the average number of children women birth while in the average reproductive age range of 15 - 50. Globally, TFR declined between 1950 and 2010, from of `r round(World_tfr$tfr[1],2)` to `r round(World_tfr$tfr[2],2)`. Both Kenya (`r round(Kenya_tfr$tfr[1],2)` to `r round(Kenya_tfr$tfr[2],2)`) and Sweden (`r round(Sweden_tfr$tfr[1],2)` to `r round(Sweden_tfr$tfr[2],2)`) saw declines during this period. However, Kenya's 2005-2010 total fertility rate is similar to the global total fertility rate in 1950-1955, despite a large decline over this half-century. 

## Question 4

```{r}
make_cdr<-function(x){
  cdr<-x %>% 
    group_by(period) %>% 
    summarise(cdr = sum(deaths) / sum(py.total))
  return(cdr)
}

Sweden_cdr<-make_cdr(Sweden)
Kenya_cdr<-make_cdr(Kenya)
World_cdr<-make_cdr(World)

Sweden_cdr
Kenya_cdr
World_cdr
```

Globally, crude death rates (CDR, displayed above) were `r round(World_cdr$cdr[1]/World_cdr$cdr[2],2)` times lower in 2005-2010 than they were in 1950-1955. In Kenya, crude death rates were `r round(Kenya_cdr$cdr[1] / Kenya_cdr$cdr[2],2)` times lower in 2005 - 2010 than 1950 - 1955, while in Sweden, the crude death rate has remained stable, at about `r round(Sweden_cdr$cdr[2] * 1000,2)` deaths per 1,000 person-years lived. Despite being more than twice as high in 1950-1955, Kenya's crude death rate has leveled off near the Sweden's CDR in 2005-2010.

## Question 5

```{r}
make_asdr<-function(x){
  x<-x %>% 
    mutate(asdr = deaths/py.total)
}

Kenya<-make_asdr(Kenya)
Sweden<-make_asdr(Sweden)

Kenya %>% filter(age=="0-4", period == "2005-2010") %>% select(asdr)
```

One key difference between Sweden and Kenya is the infant mortality rate. Despite having similar crude death rates in 2005 - 2010, Kenya's infant mortality rate remains far higher than Sweden's. I calculate age-specific death rates (ASDR) as the number of deaths per person-year lived by age-group. In Kenya, infants and children below the age of 5 died at a rate of `r Kenya %>% filter(age=="0-4", period == "2005-2010") %>% select(asdr)` per person-year, while infants and children below age 5 died at a rate `r Kenya %>% filter(age=="0-4", period == "2005-2010") %>% select(asdr) / Sweden %>% filter(age=="0-4", period == "2005-2010") %>% select(asdr)` times less frequently in Sweden. There remain dramatic differences in mortality across Kenya and Sweden, despite a leveling off of the crude death rate between the two nations.

## Question 6

```{r}
Sweden.tot<-Sweden %>% 
  filter(period=="2005-2010") %>% 
  summarise(py.total = sum(py.total))

Kenya05<-Kenya %>% 
  filter(period=="2005-2010") 

Sweden05<-Sweden %>% 
  filter(period=="2005-2010")%>% 
  mutate(py.prop = py.total / Sweden.tot$py.total)

Kenya_cdr_cfact<-Kenya05 %>% 
  summarise(cdr = sum(asdr * Sweden05$py.prop))

```

To evaluate how the age-distribution of Kenya's population may contribute to differences in the crude death rate between Kenya and Sweden, I construct a counterfactual, where I evaluate what the CDR in Kenya would have been in 2005-2010 if it had Sweden's age-distribution and Kenya's age-specific death rates. This counterfactual death rate is `r round(Kenya_cdr_cfact * 1000,2)` per 1,000 person years, compared to the actual 2005-2010 Kenyan CDR of `r round(Kenya_cdr$cdr[2] * 1000,2)`. Because so many Kenyans continue to die at very young ages, the crude death rate understates the difference between then countries in the frequency of death. If Kenya's population had a similar age-profile to Sweden's, my analysis suggests that the CDR would be `r round(Kenya_cdr_cfact/Kenya_cdr$cdr[2] ,2)` times higher.