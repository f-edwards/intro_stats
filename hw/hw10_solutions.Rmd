---
title: "HW9"
author: "Your name here"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)

polls08<-read.csv("https://raw.githubusercontent.com/kosukeimai/qss/master/UNCERTAINTY/polls08.csv")
```

This assignment uses the polls08 data from the qss library

Compute quantities of interest using all poll results for the following states: {MI, NM, WI, CA, NY, NJ, ME}

- Visualize the distribution of poll results for each candidate in each of these states (histograms or densities are most appropriate)

```{r}
polls_dat<-polls08 %>% 
  filter(state%in%c("MI", "NM", "WI", "CA", "NY", "NJ", "ME"))

ggplot(polls_dat,
       aes(x = Obama)) + 
  geom_histogram() + 
  facet_wrap(~state) + 
  labs(title = "Obama 2008 poll results")

ggplot(polls_dat,
       aes(x = McCain)) + 
  geom_histogram() + 
  facet_wrap(~state) + 
  labs(title = "McCain 2008 poll results")
```

- Compute the average poll result $\bar{x}$ for each state for both Obama and McCain support

```{r}
polls_dat %>% 
  group_by(state) %>% 
  summarize(xbar_obama = mean(Obama),
            xbar_mccain = mean(McCain))
```

- Compute the variance of poll results for each candidate and each state

```{r}
polls_dat %>% 
  group_by(state) %>% 
  summarize(var_obama = var(Obama),
            var_mccain = var(McCain))
```

- Compute a 90 percent confidence interval for each candidate and each state

```{r}
### set critical values for 90 percent CI
z<-qnorm(0.05, 0, 1)
### compute mean and SD for each candidate
polls_ci<-polls_dat %>% 
  group_by(state) %>% 
  summarize(xbar_obama = mean(Obama),
            xbar_mccain = mean(McCain),
            sd_obama = sd(Obama),
            sd_mccain = sd(McCain)) %>% 
  # then compute CI
  mutate(obama_90_lower = xbar_obama - sd_obama * z,
         obama_90_upper = xbar_obama + sd_obama * z,
         mccain_90_lower = xbar_mccain - sd_mccain * z,
         mccain_90_upper = xbar_mccain + sd_mccain * z)

### bonus - visualize your intervals
ggplot(polls_ci,
       aes(y = state)) + 
  geom_errorbar(aes(xmin = obama_90_lower,
                    xmax = obama_90_upper),
                color = "blue", alpha = 0.5) + 
  geom_errorbar(aes(xmin = mccain_90_lower,
                    xmax = mccain_90_upper),
                color = "red", alpha = 0.5)
```

- Describe each candidate's likely vote total as a margin of error with your 90 \% interval for each state

This will be equal to xbar + or z * the standard deviation. 

so for CA, Obama's likely vote share is 53.3 +/- 6.2, and so on

- For each state, conduct the following hypothesis test at the $\alpha = 0.05$ threshold:

$$H_0: \mu_{Obama} - \mu_{McCain} = 0 $$

```{r}
### here's how top do it for two states, repeat for all of them

CA<-polls_dat %>% 
  filter(state=="CA")

t.test(CA$Obama, CA$McCain)

WI<-polls_dat %>% 
  filter(state == "WI")

t.test(WI$Obama, WI$McCain)

```

- What do these tests tell you?

For California, we can reject the null hypothesis that Obama's average vote share is equal to McCain's average vote share. Assuming these polls are valid, Obama is likely to have more votes than McCain in California. 

We can also reject the null hypothesis in Wisconsin. These polls suggest that Obama is likely to have more votes than McCain.